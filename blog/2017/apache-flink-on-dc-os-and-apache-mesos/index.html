<!doctype html><html><head><link rel="stylesheet" type="text/css" href="../../../styles/index-v=1490984623561.css"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charset="UTF-8"/><link rel="shortcut icon" type="image/x-icon" href="../../../assets/images/icons/favicon/favicon.ico"/><link rel="apple-touch-icon" href="../../../assets/images/icons/favicon/favicon-apple-57x57.png"/><link rel="apple-touch-icon" sizes="72x72" href="../../../assets/images/icons/favicon/favicon-apple-72x72.png"/><link rel="apple-touch-icon" sizes="114x114" href="../../../assets/images/icons/favicon/favicon-apple-114x114.png"/><link rel="apple-touch-icon" sizes="144x144" href="../../../assets/images/icons/favicon/favicon-apple-144x144.png"/><link rel="apple-touch-icon-precomposed" href="../../../assets/images/icons/favicon/favicon-apple-57x57.png"/><link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../../assets/images/icons/favicon/favicon-apple-72x72.png"/><link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../../assets/images/icons/favicon/favicon-apple-114x114.png"/><link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../../assets/images/icons/favicon/favicon-apple-144x144.png"/><link rel="apple-touch-icon" sizes="60x60" href="../../../assets/images/icons/favicon/favicon-apple-60x60.png"/><link rel="apple-touch-icon" sizes="76x76" href="../../../assets/images/icons/favicon/favicon-apple-76x76.png"/><link rel="apple-touch-icon" sizes="120x120" href="../../../assets/images/icons/favicon/favicon-apple-120x120.png"/><link rel="apple-touch-icon" sizes="152x152" href="../../../assets/images/icons/favicon/favicon-apple-152x152.png"/><link rel="apple-touch-icon-precomposed" sizes="60x60" href="../../../assets/images/icons/favicon/favicon-apple-60x60.png"/><link rel="apple-touch-icon-precomposed" sizes="76x76" href="../../../assets/images/icons/favicon/favicon-apple-76x76.png"/><link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../../assets/images/icons/favicon/favicon-apple-120x120.png"/><link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../assets/images/icons/favicon/favicon-apple-152x152.png"/><title>Apache Flink on DC/OS (and Apache Mesos) | The Definitive Platform for Modern Apps | DC/OS</title><meta property="og:locale" content="en_US"/><meta property="og:type" content="article"/><meta property="og:title" content="Apache Flink on DC/OS (and Apache Mesos) | DC/OS"/><meta property="og:image" content="https://dcos.io/assets/images/social-img.png"/><meta property="og:description" content="Staring with version 1.2, Apache Flink now includes Apache Mesos support. Learn how to leverage it by deploying Flink on DC/OS."/><meta property="og:url" content="https://dcos.io/"/><meta property="og:site_name" content="DC/OS"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@dcos"/><meta name="twitter:title" content="Apache Flink on DC/OS (and Apache Mesos)"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image" content="https://dcos.io/assets/images/social-img.png"/><meta name="twitter:description" content="Staring with version 1.2, Apache Flink now includes Apache Mesos support. Learn how to leverage it by deploying Flink on DC/OS."/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/github-gist.min.css"/><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/languages/javascript.min.js"></script></head><body><div class="container container--blog-header"><nav class="navigation"><div class="mobile-nav-container"><a id="nav-icon" href="index.html#"><span></span><span></span><span></span><span></span></a><div class="nav-logo-container"><a href="../../../index.html" class="nav-logo"><div class="logo"></div></a></div></div><ul class="menu-mobile"><li class="menu-item"><a href="../../../why-dcos/index.html">Who&nbsp;We&nbsp;Are!</a></li><li class="menu-item"><a href="../../../install/index.html">Install</a></li><li class="menu-item"><a href="../../../docs/1.9/index.html">Docs</a></li><li class="menu-item"><a href="../../../community/index.html">Community</a></li><li class="menu-item"><a href="../../index.html">Blog</a></li><li class="menu-item"><a href="https://github.com/dcos/dcos" target="_blank">GitHub</a></li><li class="menu-item"><a href="../../../get-started/index.html">Get Started</a></li></ul><ul class="menu"><li class="menu-item"><a href="../../../why-dcos/index.html">Who&nbsp;We&nbsp;Are!</a></li><li class="menu-item"><a href="../../../install/index.html">Install</a></li><li class="menu-item"><a href="../../../docs/1.9/index.html">Docs</a></li><li class="menu-item"><a href="../../../community/index.html">Community</a></li><li class="menu-item"><a href="../../index.html">Blog</a></li><li class="menu-item"><div class="menu-item__github-button"><a href="https://github.com/dcos/dcos" data-count-href="/dcos/dcos/stargazers" data-count-api="/repos/dcos/dcos#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star dcos/dcos on GitHub" class="github-button">Star</a></div></li><li class="menu-item"><a href="../../../get-started/index.html" class="cta cta--button button--secondary">Get&nbsp;Started</a></li></ul></nav><div class="container__content"><div class="blog__category"><a href="../../index.html">UNIVERSE</a></div><h2>Apache Flink on DC/OS (and Apache Mesos)</h2></div></div><div class="container"><div class="container__content blog-article-wrapper"><div class="post-meta"><a href="https://twitter.com/stsffap" target="_blank" class="post-meta__author">Till Rohrmann, data Artisans</a><div class="post-meta__date">Feb 27th, 2017</div><div class="post-divider"></div></div><article class="post-content blog-article"><p>Last December, data Artisans organized the first-ever <a href="http://flink.apache.org/">Apache Flink®</a> user survey. We asked the community where they were running Flink, and here’s what we found:</p>
<p><img src="../../../assets/images/blog/2017-02-27_Flink_image_0.png" alt="User survey reslults"/></p>
<p>Just under 30% of respondents were running Flink on <a href="http://mesos.apache.org">Apache Mesos</a> (on-premise or in the cloud). Notably, Flink <em>hadn’t even provided official support for Mesos</em> until this month’s Flink 1.2 release. This 30% is a testament to Mesos’ popularity.</p>
<p>It comes as no surprise, then, that demand for Mesos support was on the rise in the Flink community and showed up as a <a href="http://data-artisans.com/flink-user-survey-2016-part-2/#new-features">common feature request</a> in the Flink user survey:</p>
<blockquote>
<p>“Excited for the upcoming Mesos integration.”</p>
<p>“Full support for Mesos”</p>
<p>“Support to run on Mesos”</p>
</blockquote>
<p>Apache Flink® 1.2 includes many improvements to Flink deployment modes, and one such improvement is support for Apache Mesos and <a href="../../../index.html">DC/OS</a> (datacenter operating system, the open-source Mesos distribution and application management layer provided by <a href="https://mesosphere.com/">Mesosphere</a>) as first-class citizens.</p>
<p>Here at data Artisans, we have seen seen a wide range of production Flink deployments, so we appreciate how quickly the resource manager space is evolving and how Flink, too, must evolve—especially as Flink supports a broader variety of use cases. A tighter integration with Mesos and DC/OS represents an important step forward in Flink’s capabilities.</p>
<p>In this post, we’ll give a high-level overview of deploying Flink on both Mesos and DC/OS. Be sure to refer to the <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.2/setup/mesos.html">complete documentation</a> before starting this process yourself.</p>
<h1 id="flink-s-interaction-with-mesos">Flink’s interaction with Mesos</h1>
<p>For the uninitiated: Flink is a stateful stream processing framework that supports high-throughput, low-latency applications. Flink is a lightweight and fault tolerant, providing strict accuracy guarantees in case of failures, with minimal impact on performance. Flink deployments cover a range of use cases; Alibaba, for example, uses Flink to <a href="http://data-artisans.com/blink-flink-alibaba-search/">optimize search results in real-time</a>.</p>
<p>Flink’s Mesos and DC/OS implementation in 1.2 consists of an Application Master, which runs the JobManager and the ResourceManager.</p>
<p>The ResourceManager hosts the Mesos scheduler communicating with the Mesos cluster and allocating resources for Mesos tasks, which run Flink’s TaskManagers.</p>
<p><img src="../../../assets/images/blog/2017-02-27_Flink_image_1.jpg" alt="Package screen capture"/></p>
<h2 id="flink-on-dc-os">Flink on DC/OS</h2>
<p>In its Mesos user survey, <a href="https://mesosphere.com/blog/2016/11/02/apache-mesos-survey-2016/">Mesosphere found</a> that 87% of new Mesos users are running DC/OS, and so Flink’s Mesos support wouldn’t be complete without DC/OS support, too. To run Flink on DC/OS, first <a href="../../../install/index.html">install DC/OS from the official site</a>.</p>
<p>Note that DC/OS includes Mesos, Marathon (a service that will supervise your applications and maintain their state in case of failures), and ZooKeeper, all pre-configured out of the box.</p>
<p>Once your DC/OS cluster is ready, you can simply search for “Flink” in Universe, install the package with a couple of clicks, and you’re ready to get started. If you’d like to use <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.2/setup/checkpoints.html">Flink’s checkpoints</a> for fault tolerance (recommended for most production deployments), you’ll also need to install HDFS.</p>
<p>We’d like to extend a big thanks to our friends at Mesosphere for their contribution to DC/OS support, enabling a seamless integration between Flink and DC/OS.</p>
<h2 id="flink-on-mesos">Flink on Mesos</h2>
<p>First things first: the <a href="http://mesos.apache.org/documentation/latest/">Mesos documentation</a> will walk you through initial Mesos setup. Next you should also <a href="https://mesosphere.github.io/marathon/docs/">install Marathon</a>, since you usually want your cluster to be highly available (HA). In order to run Marathon, you also need a ZooKeeper quorum running. We assume for the following that ZooKeeper is reachable under node:2181. Lastly, we recommend installing a distributed file system where Flink can store its checkpoints. We assume for the following that HDFS is installed and can be reached via hdfs://node/.</p>
<p>After installing Mesos and Co. we have to enable Flink’s HA functionality by adding the following lines to Flink’s configuration file:</p>
<pre><code>high-availability: zookeeper

high-availability.zookeeper.quorum: node:2181

high-availability.zookeeper.storageDir: hdfs://node/flink/ha

recovery.zookeeper.path.mesos-workers: /mesos-workers
</code></pre><p>Last but not least, we have to start Flink as a Marathon application by giving the following JSON application description to Marathon:</p>
<pre><code>{

  &quot;id&quot;: &quot;flink&quot;,

  &quot;cmd&quot;: &quot;$FLINK/bin/mesos-appmaster.sh -Dmesos.master=node:5050 -Dmesos.initial-tasks=1&quot;,

  &quot;cpus&quot;: 1.0,

  &quot;mem&quot;: 1024

}
</code></pre><p>Congratulations. You now have a highly-available Flink cluster running on Mesos!</p>
<h1 id="looking-ahead">Looking Ahead</h1>
<p>The Flink community is actively working on improvements beyond the 1.2 release, and will add two key components in the near future.</p>
<ol>
<li><p><strong>Dynamic resource allocation:</strong> In Flink 1.2, it’s not possible to dynamically adjust the number of tasks allocated to a job running on Mesos. <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=65147077">FLIP-6</a> will address this issue by separating the concerns of all deployment components. A dispatcher component will receive jobs and spawn Flink clusters, and the new ResourceManager will dynamically allocate new tasks if more resources are needed.</p>
</li>
<li><p><strong>Integration with the Flink CLI:</strong> In the future, it will be possible to start a Mesos cluster per job using the Flink CLI. Right now, a user must first start a Flink cluster on Mesos and then submit a long-running cluster session.</p>
</li>
</ol>
<p>We believe that the Flink community’s work in partnership with Mesosphere will enable a broader range of Flink deployments, and we look forward to hearing user feedback about this new integration. Please contact the <a href="http://flink.apache.org/community.html#mailing-lists">Apache Flink user mailing list</a> if you have comments or questions.</p>
</article><div class="blog__article-footer"><a href="http://twitter.com/share?text=Apache%20Flink%20on%20DC%2FOS%20(and%20Apache%20Mesos)&url=https://dcos.io/blog/2017/apache-flink-on-dc-os-and-apache-mesos/index.html" target="_blank" class="blog__social-share"><img src="../../../assets/images/icons/twitter-icon.svg"/><p>Tweet</p></a><a href="https://www.facebook.com/sharer/sharer.php?u=https://dcos.io/blog/2017/apache-flink-on-dc-os-and-apache-mesos/index.html" target="_blank" class="blog__social-share"><img src="../../../assets/images/icons/facebook-icon.svg"/><p>Share</p></a><a href="https://plus.google.com/share?url=https://dcos.io/blog/2017/apache-flink-on-dc-os-and-apache-mesos/index.html" target="_blank" class="blog__social-share"><img src="../../../assets/images/icons/googleplus-icon.svg"/><p>Share</p></a><a href="http://news.ycombinator.com/submit" target="_blank" class="blog__social-share"><img src="../../../assets/images/icons/hackernews-icon.svg"/><p>Vote</p></a></div><div id="disqus_thread" style="width: 100%"></div><script>/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//dcos-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();</script><noscript>Please enable JavaScript to view the<a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div><div class="container"><div class="container__content container__content--footer"><div class="footer"><ul class="footer-main"><li class="footer-item"><a href="../../../contribute/index.html">Contribute</a></li><li class="footer-item"><a href="../../../tos/index.html">Terms&nbsp;of&nbsp;Service</a></li><li class="footer-item"><a href="../../../privacy/index.html">Privacy&nbsp;Policy</a></li><li class="footer-item"><a href="../../../releases/index.html">Releases</a></li><li class="footer-item"><a href="https://dcos.io/brand/">Press&nbsp;Kit</a></li></ul><ul class="footer-secondary"><li class="footer-item"><a href="http://www.twitter.com/dcos"><img src="../../../assets/images/icons/twitter-dark.svg" class="footer-item__icon twitter-icon"/><span>Twitter</span></a></li><li class="footer-item"><a href="http://chat.mesosphere.com"><img src="../../../assets/images/icons/slack-dark.svg" class="footer-item__icon"/><span>Slack</span></a></li><li class="footer-item"><a href="https://github.com/dcos"><img src="../../../assets/images/icons/github-dark.svg" class="footer-item__icon"/><span>GitHub</span></a></li></ul></div></div><!-- Google Tag Manager--><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MT2WX7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MT2WX7');
</script><script src="../../../assets/javascript/picturefill/dist/picturefill.min.js"></script><script src="../../../assets/javascript/jquery/dist/jquery.min.js"></script><script src="../../../assets/javascript/sticky-kit.min.js"></script><script src="../../../assets/javascript/lunr/lunr.min.js"></script><script src="../../../assets/javascript/jquery.scrollNav.min.js"></script><script src="../../../scripts/main.min.js"></script><script id="github-bjs" async="async" defer="defer" src="https://buttons.github.io/buttons.js"></script></div></body></html>